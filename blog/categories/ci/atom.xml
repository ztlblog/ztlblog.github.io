<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ci | Blog like hacke]]></title>
  <link href="http://ztlblog.github.io/blog/categories/ci/atom.xml" rel="self"/>
  <link href="http://ztlblog.github.io/"/>
  <updated>2015-08-12T14:02:42+08:00</updated>
  <id>http://ztlblog.github.io/</id>
  <author>
    <name><![CDATA[ztl]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[codeigniter之表单验证]]></title>
    <link href="http://ztlblog.github.io/blog/2015/06/29/ci001/"/>
    <updated>2015-06-29T10:01:02+08:00</updated>
    <id>http://ztlblog.github.io/blog/2015/06/29/ci001</id>
    <content type="html"><![CDATA[<p>{% codeblock html %}
<form action="" method="POST" enctype="multipart/form-data">
    <table class="table">
        <tr >
            <td class="th" colspan="10">编辑文章</td>
        </tr>
        <tr>
            <td>标题</td>
            <td><input type="text" name="title" value="<?php echo set_value('title') ?>&ldquo;/>
            &lt;?php echo form_error(&lsquo;title&rsquo;, &lsquo;<span>&rsquo;, &lsquo;</span>&rsquo;) ?>
            </td>
        </tr>
        <tr>
            <td>类型</td>
            <td>
                <input type="radio" name="type" value="0"<?php echo set_radio('type', '0', TRUE) ?>/> 普通
                <input type="radio" name="type" value="1"<?php echo set_radio('type', '1') ?>/> 热门
            </td>
        </tr>
        <tr>
            <td>栏目</td>
            <td>
                <select name="cid" id="">
                    <option value="1"<?php echo set_select('cid', '1', TRUE) ?>>情感</option>
                    <option value="2"<?php echo set_select('cid', '2') ?>>生活</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>缩略图</td>
            <td>
                <input type="file" />
            </td>
        </tr>
        <tr>
            <td>摘要</td>
            <td>
                <textarea name="info" id="" style="width:550px;height:160px;">&lt;?php echo set_value(&lsquo;info&rsquo;) ?></textarea>&lt;?php echo form_error(&lsquo;info&rsquo;, &lsquo;<span>&rsquo;, &lsquo;</span>&rsquo;) ?>
            </td>
        </tr>
        <tr>
            <td>内容</td>
            <td>
                <textarea name="content" id="" style="width:550px;height:500px;">&lt;?php echo set_value(&lsquo;content&rsquo;) ?></textarea>
                &lt;?php echo form_error(&lsquo;content&rsquo;, &lsquo;<span>&rsquo;, &lsquo;</span>&rsquo;) ?>
            </td>
        </tr>
        <tr>
            <td colspan="10"><input type="submit" class="input_button" value="发布"/></td>
        </tr>
    </table>
    </form>
{% endcodeblock %}</p>

<p>{% codeblock php %}
public function send(){
        //载入表单验证类
        $this->load->library(&lsquo;form_validation&rsquo;);
        //引入验证规则
        $status = $this->form_validation->run(&lsquo;article&rsquo;);</p>

<pre><code>    if($status){
        //文件上传------------------------
        //配置
        $config['upload_path'] = './uploads/';
        $config['allowed_types'] = 'gif|jpg|png|jpeg';
        $config['max_size'] = '10000';
        $config['file_name'] = time() . mt_rand(1000,9999);

        //载入上传类
        $this-&gt;load-&gt;library('upload', $config);
        //执行上传
        $status = $this-&gt;upload-&gt;do_upload('thumb');

        $wrong = $this-&gt;upload-&gt;display_errors();

        if($wrong){
            error($wrong);
        }
        //返回信息
        $info = $this-&gt;upload-&gt;data();

        //缩略图-----------------
        //配置
        $arr['source_image'] = $info['full_path'];
        $arr['create_thumb'] = FALSE;
        $arr['maintain_ratio'] = TRUE;
        $arr['width'] = 200;
        $arr['height'] = 200;   

        //载入缩略图类
        $this-&gt;load-&gt;library('image_lib', $arr);
        //执行动作
        $status = $this-&gt;image_lib-&gt;resize();

        if(!$status){
            error('缩略图动作失败');
        }

        $this-&gt;load-&gt;model('article_model', 'art');

        $data = array(
            'title' =&gt; $this-&gt;input-&gt;post('title'),
            'type'  =&gt; $this-&gt;input-&gt;post('type'),
            'cid'   =&gt; $this-&gt;input-&gt;post('cid'),
            'thumb' =&gt; $info['file_name'],
            'info'  =&gt; $this-&gt;input-&gt;post('info'),
            'content'=&gt; $this-&gt;input-&gt;post('content'),
            'time'  =&gt; time()
            );  

        $this-&gt;art-&gt;add($data);
        success('admin/article/index', '发表成功');
    }else {
        $this-&gt;load-&gt;model('category_model', 'cate');
        $data['category'] = $this-&gt;cate-&gt;check();
        $this-&gt;load-&gt;helper('form');
        $this-&gt;load-&gt;view('admin/article.html',$data);
    }
}
</code></pre>

<p>{% endcodeblock %}
<strong>注意:</strong>保存验证规则需要在application/config/文件夹下创建一个名称为form_validation.php的文件。然后将配置信息保存在数组$config中即可.
{% codeblock  form_validation %}
$config = array(
    &lsquo;article&rsquo;   =>  array(
            array(
                &lsquo;field&rsquo; =>  &lsquo;title&rsquo;,
                &lsquo;label&rsquo; => &lsquo;标题&rsquo;,
                &lsquo;rules&rsquo; => &lsquo;required|min_length[5]&rsquo;
                ),
            array(
                &lsquo;field&rsquo; =>  &lsquo;type&rsquo;,
                &lsquo;label&rsquo; => &lsquo;类型&rsquo;,
                &lsquo;rules&rsquo; => &lsquo;required|integer&rsquo;
                ),
            array(
                &lsquo;field&rsquo; =>  &lsquo;cid&rsquo;,
                &lsquo;label&rsquo; => &lsquo;栏目&rsquo;,
                &lsquo;rules&rsquo; => &lsquo;integer&rsquo;
                ),
            array(
                &lsquo;field&rsquo; =>  &lsquo;info&rsquo;,
                &lsquo;label&rsquo; => &lsquo;摘要&rsquo;,
                &lsquo;rules&rsquo; => &lsquo;required|max_length[155]&rsquo;
                ),
            array(
                &lsquo;field&rsquo; =>  &lsquo;content&rsquo;,
                &lsquo;label&rsquo; => &lsquo;内容&rsquo;,
                &lsquo;rules&rsquo; => &lsquo;required|max_length[2000]&rsquo;
                )</p>

<pre><code>    ),
'cate'  =&gt; array(
        array(
            'field' =&gt; 'cname',
            'label' =&gt; '栏目名称',
            'rules' =&gt; 'required|max_length[20]'
            ),

    ),

);
</code></pre>

<p>{% endcodeblock %}</p>
]]></content>
  </entry>
  
</feed>
